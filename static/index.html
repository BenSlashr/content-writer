<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Writer - Rédaction SEO guidée</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
/* Styles personnalisés pour Content Writer */

/* Styles pour le menu de navigation */
nav.bg-gray-800 {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

nav .container {
    max-width: 1280px;
}

nav img.h-8 {
    transition: transform 0.2s ease;
}

nav img.h-8:hover {
    transform: scale(1.05);
}

nav a {
    font-weight: 500;
    font-size: 0.95rem;
    position: relative;
}

nav a::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -4px;
    left: 0;
    background-color: #60a5fa;
    transition: width 0.3s ease;
}

nav a:hover::after {
    width: 100%;
}


/* Styles pour les mots-clés */
.keyword-item {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem;
    border-radius: 0.375rem;
    background-color: #f3f4f6;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    max-width: 48%;
}

.keyword-count {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    background-color: #e5e7eb;
    font-weight: 600;
    font-size: 0.75rem;
    margin-right: 0.5rem;
}

.keyword-count.completed {
    background-color: #10b981;
    color: white;
}

.keyword-text {
    font-size: 0.875rem;
    color: #4b5563;
}

.keyword-text.completed {
    color: #10b981;
    font-weight: 600;
}

.keyword-required {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-left: auto;
}

/* Styles pour les n-grams */
.ngram-item {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    background-color: #f3f4f6;
    font-size: 0.75rem;
    color: #4b5563;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
}

.ngram-item.found {
    background-color: #d1fae5;
    color: #065f46;
    font-weight: 600;
}

/* Styles pour l'éditeur */
#editor {
    min-height: 500px;
    max-height: 70vh;
    line-height: 1.5;
    font-size: 1rem;
    color: #1f2937;
    overflow-y: auto;
    word-wrap: break-word;
    white-space: pre-wrap;
    position: relative;
    width: 100%;
    box-sizing: border-box;
}

#editor:focus {
    outline: none;
    border-color: #3b82f6;
}

/* Styles pour les mots surlignés */
mark {
    background-color: #fef3c7;
    padding: 0 2px;
    border-radius: 2px;
}

mark.obligatoire {
    background-color: #d1fae5;
}

mark.complementaire {
    background-color: #dbeafe;
}

mark.ngram {
    background-color: #fef3c7;
}

/* Styles pour les statistiques */
.stat-card {
    border-radius: 0.5rem;
    padding: 1rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
}

.stat-label {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Styles pour les tooltips */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: #1f2937;
    color: white;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.75rem;
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Styles pour les menus déroulants */
.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 10;
    border-radius: 4px;
}

.dropdown-content button {
    color: black;
    padding: 8px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
    width: 100%;
    border: none;
    background: none;
    cursor: pointer;
}

.dropdown-content button:hover {
    background-color: #f1f1f1;
}

.show {
    display: block;
}

/* Styles pour l'éditeur de texte enrichi */
#editor h1 {
    font-size: 2em;
    font-weight: bold;
    margin: 0.67em 0;
}

#editor h2 {
    font-size: 1.5em;
    font-weight: bold;
    margin: 0.83em 0;
}

#editor h3 {
    font-size: 1.17em;
    font-weight: bold;
    margin: 1em 0;
}

#editor h4 {
    font-size: 1em;
    font-weight: bold;
    margin: 1.33em 0;
}

#editor blockquote {
    border-left: 4px solid #e5e7eb;
    padding-left: 1em;
    margin-left: 0;
    margin-right: 0;
    font-style: italic;
    color: #6b7280;
}

#editor ul {
    list-style-type: disc;
    margin-left: 1.5em;
}

#editor ol {
    list-style-type: decimal;
    margin-left: 1.5em;
}

#editor code {
    font-family: monospace;
    background-color: #f3f4f6;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
}

#editor table {
    border-collapse: collapse;
    width: 100%;
    margin: 1em 0;
}

#editor table, #editor th, #editor td {
    border: 1px solid #e5e7eb;
}

#editor th, #editor td {
    padding: 0.5em;
    text-align: left;
}

#editor th {
    background-color: #f9fafb;
    font-weight: bold;
}

#editor a {
    color: #3b82f6;
    text-decoration: underline;
}

#editor img {
    max-width: 100%;
    height: auto;
}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
    <!-- ApexCharts pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Menu de navigation -->
    <nav class="bg-gray-800 text-white py-3 mb-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#" class="flex items-center">
                <img src="https://agence-slashr.fr/wp-content/uploads/2023/10/slashr-logo-white.svg" alt="SlashR Logo" class="h-8">
            </a>
            <div class="flex space-x-6">
                <a href="https://outils.agence-slashr.fr/" class="hover:text-blue-300 transition duration-200">Nos outils</a>
                <a href="https://agence-slashr.fr/seo/" class="hover:text-blue-300 transition duration-200">Agence SEO à Lille</a>
            </div>
        </div>
    </nav>
    
    <div class="container mx-auto p-4">
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-center text-gray-800">Content Writer</h1>
            <p class="text-center text-gray-600">Assistant de rédaction SEO avec analyse en temps réel</p>
        </header>

        <!-- Graphique d'optimisation (en grand au-dessus) -->
        <div class="w-full bg-white rounded-lg shadow-md p-4 mb-4">
            <h2 class="text-xl font-semibold mb-2">Graphique d'optimisation</h2>
            <div class="bg-white p-4 rounded-lg shadow-sm" style="height: 300px; position: relative; overflow: visible;">
                <div id="optimization-chart" style="width: 100%; height: 100%;"></div>
            </div>
            <div class="flex justify-between mt-2 text-xs">
                <div class="flex items-center">
                    <span class="inline-block w-3 h-3 rounded-full bg-red-500 mr-1"></span>
                    <span>Suroptimisation</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-3 h-3 rounded-full bg-yellow-500 mr-1"></span>
                    <span>Optimisation forte</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-3 h-3 rounded-full bg-green-400 mr-1"></span>
                    <span>Optimisation normale</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-3 h-3 rounded-full bg-blue-300 mr-1"></span>
                    <span>Sous-optimisation</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-3 h-3 rounded-full bg-black mr-1"></span>
                    <span>Votre contenu</span>
                </div>
            </div>
            <!-- Liste des mots-clés du graphique -->
            <div id="graph-keywords-list" class="mt-4 pt-2 border-t border-gray-200 text-xs flex flex-wrap gap-2"></div>
        </div>
        
        <div class="flex flex-col md:flex-row mt-4 space-y-4 md:space-y-0 md:space-x-4">
            <!-- Panneau de gauche - Statistiques et mots-clés -->
            <div class="w-full md:w-1/3 bg-white rounded-lg shadow-md p-4 h-screen overflow-y-auto">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-2">Statistiques</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Score SEO -->
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-gray-600">Score SEO</h3>
                            <div class="flex items-center">
                                <span id="score-seo" class="text-2xl font-bold text-green-600">0%</span>
                                <div class="ml-2 text-xs text-gray-500">
                                    <span>sur les <span id="kw-obligatoires-count">0</span> % requis</span>
                                    <span class="ml-1 cursor-pointer text-blue-500" title="Pourcentage de mots-clés obligatoires utilisés par rapport au minimum requis"><i class="fas fa-info-circle"></i></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 200 premiers mots -->
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-gray-600">Mots-clés en intro</h3>
                            <div class="flex items-center">
                                <span id="premiers-mots-percent" class="text-2xl font-bold text-green-600">0/4</span>
                                <div class="ml-2 text-xs text-gray-500">
                                    <span>dans les 200 premiers mots</span>
                                    <span class="ml-1 cursor-pointer text-blue-500" title="Nombre de mots-clés obligatoires présents dans les 200 premiers mots. Objectif: au moins 4 mots-clés pour optimiser le début du contenu."><i class="fas fa-info-circle"></i></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Suroptimisation -->
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-gray-600">Suroptimisation</h3>
                            <div class="flex items-center">
                                <span id="suroptimisation" class="text-2xl font-bold text-green-600">0%</span>
                                <div class="ml-2 text-xs text-gray-500">
                                    <span>max: <span id="max-suroptimisation">0</span> %</span>
                                    <span class="ml-1 cursor-pointer text-blue-500" title="Niveau de suroptimisation du contenu. Une valeur faible est meilleure. Ne pas dépasser la valeur maximale."><i class="fas fa-info-circle"></i></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nombre de mots -->
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-gray-600">Mots</h3>
                            <div class="flex items-center">
                                <span id="word-count" class="text-2xl font-bold text-green-600">0</span>
                                <div class="ml-2 text-xs text-gray-500">
                                    <span>sur les <span id="mots-requis">0</span> requis (encore <span id="mots-restants">0</span>)</span>
                                    <span class="ml-1 cursor-pointer text-blue-500" title="Nombre total de mots dans le contenu par rapport au minimum recommandé"><i class="fas fa-info-circle"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Commander un guide -->
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold">Commander un guide</h2>
                        <button id="toggle-guide" class="text-sm bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center focus:outline-none">+</button>
                    </div>
                    <div id="guide-content" class="mt-2 space-y-2 hidden">
                        <div class="flex">
                            <input type="text" id="guide-keywords" placeholder="Entrez un mot-clé" class="flex-grow p-2 border rounded-l">
                            <button id="order-guide-button" class="bg-blue-500 text-white px-4 py-2 rounded-r">Commander un guide</button>
                        </div>
                        <div class="mt-2">
                            <button id="load-default-data" class="bg-gray-500 text-white px-4 py-2 rounded w-full">Charger des données par défaut</button>
                        </div>
                        <div id="guide-status" class="hidden"></div>
                    </div>
                </div>
                
                <!-- Section Intention de recherche supprimée -->

                <!-- Mots-clés obligatoires -->
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold">Mots-clés obligatoires</h2>
                        <span class="text-sm text-gray-500" id="kw-obligatoires-summary">0/0</span>
                    </div>
                    <div class="mt-2 space-y-2" id="kw-obligatoires-list">
                        <!-- Les mots-clés obligatoires seront ajoutés ici dynamiquement -->
                    </div>
                </div>

                <!-- Mots-clés complémentaires -->
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold">Mots-clés complémentaires</h2>
                        <span class="text-sm text-gray-500" id="kw-complementaires-summary">0/0</span>
                    </div>
                    <div class="mt-2 space-y-2" id="kw-complementaires-list">
                        <!-- Les mots-clés complémentaires seront ajoutés ici dynamiquement -->
                    </div>
                </div>

                <!-- N-grams -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-2">Expressions à utiliser</h2>
                    <div class="mt-2 space-y-2" id="ngrams-list">
                        <!-- Les n-grams seront ajoutés ici dynamiquement -->
                    </div>
                </div>
                
                <!-- Espace réservé pour d'autres éléments si nécessaire -->
                <div class="mb-6">
                    <!-- Contenu supplémentaire peut être ajouté ici si nécessaire -->
                </div>
            </div>

            <!-- Panneau de droite - Éditeur de contenu -->
            <div class="w-full md:w-2/3 bg-white rounded-lg shadow-md p-4 h-screen overflow-y-auto">
                <div class="mb-4">
                    <!-- Boutons de navigation supprimés -->
                    
                    <div class="border rounded-md mb-4">
                        <input type="text" id="title-input" placeholder="Titre de votre article" class="w-full p-3 border-b">
                        
                        <!-- Première rangée de boutons de formatage -->
                        <div class="flex flex-wrap border-b">
                            <!-- Titres -->
                            <div class="dropdown relative inline-block">
                                <button id="heading-button" class="p-2 border-r hover:bg-gray-100" title="Titres">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8" />
                                    </svg>
                                </button>
                                <div id="heading-dropdown" class="dropdown-content hidden absolute bg-white shadow-lg z-10 w-32">
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-format="h1">Titre 1</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-format="h2">Titre 2</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-format="h3">Titre 3</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-format="h4">Titre 4</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-format="p">Paragraphe</button>
                                </div>
                            </div>
                            
                            <!-- Gras -->
                            <button id="bold-button" class="p-2 border-r hover:bg-gray-100" title="Gras">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                                </svg>
                            </button>
                            
                            <!-- Italique -->
                            <button id="italic-button" class="p-2 border-r hover:bg-gray-100" title="Italique">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="19" y1="4" x2="10" y2="4"></line>
                                    <line x1="14" y1="20" x2="5" y2="20"></line>
                                    <line x1="15" y1="4" x2="9" y2="20"></line>
                                </svg>
                            </button>
                            
                            <!-- Souligné -->
                            <button id="underline-button" class="p-2 border-r hover:bg-gray-100" title="Souligné">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path>
                                    <line x1="4" y1="21" x2="20" y2="21"></line>
                                </svg>
                            </button>
                            
                            <!-- Barré -->
                            <button id="strikethrough-button" class="p-2 border-r hover:bg-gray-100" title="Barré">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 9V5a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v4"></path>
                                    <path d="M20 12H4"></path>
                                    <path d="M11 12a2 2 0 0 1 2 2v3a2 2 0 0 0 2 2h2"></path>
                                </svg>
                            </button>
                            
                            <!-- Liste à puces -->
                            <button id="bullet-list-button" class="p-2 border-r hover:bg-gray-100" title="Liste à puces">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            
                            <!-- Liste numérotée -->
                            <button id="numbered-list-button" class="p-2 border-r hover:bg-gray-100" title="Liste numérotée">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="10" y1="6" x2="21" y2="6"></line>
                                    <line x1="10" y1="12" x2="21" y2="12"></line>
                                    <line x1="10" y1="18" x2="21" y2="18"></line>
                                    <path d="M4 6h1v4"></path>
                                    <path d="M4 10h2"></path>
                                    <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
                                </svg>
                            </button>
                            
                            <!-- Citation -->
                            <button id="blockquote-button" class="p-2 border-r hover:bg-gray-100" title="Citation">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>
                            
                            <!-- Lien -->
                            <button id="link-button" class="p-2 border-r hover:bg-gray-100" title="Lien">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                </svg>
                            </button>
                            
                            <!-- Image -->
                            <button id="image-button" class="p-2 border-r hover:bg-gray-100" title="Image">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                            </button>
                            
                            <!-- Tableau -->
                            <button id="table-button" class="p-2 hover:bg-gray-100" title="Tableau">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="3" y1="9" x2="21" y2="9"></line>
                                    <line x1="3" y1="15" x2="21" y2="15"></line>
                                    <line x1="9" y1="3" x2="9" y2="21"></line>
                                    <line x1="15" y1="3" x2="15" y2="21"></line>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Deuxième rangée de boutons de formatage -->
                        <div class="flex border-b">
                            <!-- Annuler -->
                            <button id="undo-button" class="p-2 border-r hover:bg-gray-100" title="Annuler">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 10h10a4 4 0 0 1 0 8H9"></path>
                                    <path d="M9 18l-6-6 6-6"></path>
                                </svg>
                            </button>
                            
                            <!-- Rétablir -->
                            <button id="redo-button" class="p-2 border-r hover:bg-gray-100" title="Rétablir">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 10H11a4 4 0 1 0 0 8h4"></path>
                                    <path d="M15 18l6-6-6-6"></path>
                                </svg>
                            </button>
                            
                            <!-- Code -->
                            <button id="code-button" class="p-2 border-r hover:bg-gray-100" title="Code">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"></polyline>
                                    <polyline points="8 6 2 12 8 18"></polyline>
                                </svg>
                            </button>
                            
                            <!-- Alignement -->
                            <div class="dropdown relative inline-block">
                                <button id="align-button" class="p-2 border-r hover:bg-gray-100" title="Alignement">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="21" y1="6" x2="3" y2="6"></line>
                                        <line x1="17" y1="12" x2="3" y2="12"></line>
                                        <line x1="21" y1="18" x2="3" y2="18"></line>
                                    </svg>
                                </button>
                                <div id="align-dropdown" class="dropdown-content hidden absolute bg-white shadow-lg z-10 w-32">
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-align="left">Gauche</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-align="center">Centre</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-align="right">Droite</button>
                                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100" data-align="justify">Justifié</button>
                                </div>
                            </div>
                            
                            <!-- Couleur du texte -->
                            <button id="text-color-button" class="p-2 border-r hover:bg-gray-100" title="Couleur du texte">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 3h6v11h2v3h-4v-3h-4v-3h2z"></path>
                                    <rect x="2" y="19" width="20" height="3" rx="1"></rect>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Éditeur de contenu -->
                    <div id="editor" class="border rounded-md p-4 min-h-[500px]" contenteditable="true"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL de l'API (à modifier selon l'environnement)
        const API_URL = 'http://localhost:8000';
        
        // Fonction pour extraire correctement les valeurs min et max d'un mot-clé
        function extractMinMaxValues(keyword) {
            // Format attendu de l'API Thot SEO : ["créatine",2,44]
            // où 2 est le minimum et 44 est le maximum
            if (Array.isArray(keyword) && keyword.length >= 3) {
                return {
                    keyword: keyword[0],
                    min: parseInt(keyword[1], 10) || 0,
                    max: parseInt(keyword[2], 10) || 0
                };
            }
            return null;
        }
        
        // Variables globales
        let currentQuery = "whey ou creatine";
        let editorTimeout = null;
        let keywords = {
            obligatoires: {},
            complementaires: {}
        };
        let ngrams = [];
        let marker = null;
        let keywordData = [];
        let optimizationChart = null;
        let editor = null;

        // Données par défaut pour le chargement rapide
        const defaultData = {
            "query": "whey ou creatine",
            "score_target": 54,
            "mots_requis": 1404,
            "KW_obligatoires": [["créatine",2,44],["whey",1,35],["prise",1,33],["muscle",2,29],["complément",2,27],["masse",2,25],["bcaa",1,25],["protéine",5,20],["alimentaire",2,21],["musculaire",2,17],["effet",3,12],["récupération",1,14],["musculation",1,12],["produit",1,12],["acide",2,10],["aminé",2,10],["force",2,9],["énergie",1,11],["monohydrate",2,8],["poudre",2,9],["dose",1,8],["consommer",1,8],["effort",2,9],["jour",1,8],["shaker",1,7],["objectif",1,7],["source",1,7],["séance",2,7],["sport",1,6],["lait",1,5],["sportif",1,6],["endurance",1,5],["exemple",1,5],["étude",1,5],["corps",1,6],["consommation",1,5],["recommandée",2,4],["bienfait",1,5],["puissance",1,6],["apport",1,5],["graisse",1,6],["meilleure",1,3],["haute",1,4],["santé",2,3],["rôle",1,4]],
            "KW_complementaires": [["pack",2,33],["collation",2,17],["taux",5,9],["substance",2,10],["point",1,11],["marque",4,6],["augmenter",2,8],["personne",1,8],["amélioration",1,8],["utilisé",1,8],["matin",2,8],["midi",2,8],["performance",2,7],["booster",1,7],["meilleur",1,7],["sportive",1,7],["développement",2,5],["prix",4,5],["gamme",1,7],["forme",2,6],["intense",2,7],["organisme",1,7],["court",2,7],["qualité",1,7],["profiter",1,7],["risque",1,7],["composition",2,7],["fabriqué",2,5],["choisir",2,4],["associer",2,4],["nutrition",2,4],["croissance",1,5],["isolate",1,4],["training",2,3],["eau",2,4],["bénéfique",1,5],["supplémentation",1,4],["dosage",1,6],["varié",2,4],["équilibré",2,4],["cadre",2,4],["essentiel",1,4],["temps",1,5],["existe",1,5],["aide",1,4],["premier",1,5],["charge",1,5],["association",2,5],["raison",1,5],["nutriment",1,5],["éviter",1,4],["haut",1,5],["dépasser",1,4],["développer",1,4],["volume",2,3],["lieu",1,5],["favoriser",1,6],["capacité",2,4],["apporte",1,5],["spécifique",1,4],["construction",2,4],["dérivée",1,4],["concentrée",1,4],["positif",1,5],["favorisant",1,5],["choix",2,3],["naturelle",2,4],["consommateur",2,4],["teneur",1,5],["goût",1,5],["formule",2,5],["format",2,4],["vie",2,4],["sain",2,4],["portée",2,4],["enfant",2,4],["sec",2,4],["marché",2,4],["forte",2,4],["conservation",2,4],["idéale",2,3],["apprécié",2,5],["partie",2,5],["supplément",1,4],["avantage",2,3],["creapure",2,3],["gramme",1,4],["utile",2,3],["première",1,2],["augmente",1,2],["contient",1,2],["repas",1,2],["lactosérum",1,2],["monde",1,2],["pratiquant",1,3],["intensité",1,4],["gain",2,3],["rapide",2,3],["article",1,2]],
            "ngrams": "grammes de créatine;lait de vache;synthèse des protéines;phase de charge;récupération musculaire;développement musculaire;protéine de lactosérum;créatine par jour;protéines de lactosérum;créatine augmente;force musculaire;nutrition sportive;whey et de créatine;grande quantité;régime alimentaire;sport nutrition;whey ou créatine;prise de muscle;supplémentation en créatine;protéine complète;courte durée;prise de masse musculaire;créatine et la whey;prenant de la créatine;adénosine triphosphate;apport protéique;prise de créatine;complément alimentaire;explosivité musculaire;augmentation de la masse;whey protein;masse maigre;prise de poids;protéine whey;construction musculaire;fonction rénale;augmentation de la force;créatine et la protéine;joue un rôle;jouent un rôle;whey isolat native;haute qualité;créatine monohydrate;faible teneur;whey isolate native;mode de vie sain;croissance musculaire;volume musculaire;protéine en poudre;petit lait;hypertrophie musculaire;haute intensité",
            "max_suroptimisation": 5
        };
        
        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM chargé, initialisation de l\'application');
            
            // Initialiser mark.js pour le surlignage
            marker = new Mark(document.getElementById("editor"));
            
            // Charger les données initiales
            loadInitialData();
            
            // Ajouter les écouteurs d'événements
            setupEventListeners();
            
            // Initialiser l'éditeur de texte enrichi
            initTextEditor();
            
            // Initialiser le graphique d'optimisation
            initOptimizationChart();
        });

        // Charger les données initiales (simuler une requête API)
        function loadInitialData() {
            fetch(`${API_URL}/analyze`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: '',
                    query: currentQuery
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Données reçues de l\'API:', data);
                
                // Stocker les mots-clés
                updateKeywordsData(data);
                
                // Mettre à jour l'interface
                updateKeywordLists();
                updateStatistics(data);
                
                // Mettre à jour le graphique
                updateOptimizationChart();
            })
            .catch(error => {
                console.error('Erreur lors du chargement des données:', error);
            });
        }

        // Configurer les écouteurs d'événements
        function setupEventListeners() {
            console.log('Configuration des écouteurs d\'événements');
            
            // Écouter les changements dans l'éditeur
            const editor = document.getElementById('editor');
            editor.addEventListener('input', function() {
                // Utiliser un délai pour éviter trop d'appels API
                clearTimeout(editorTimeout);
                editorTimeout = setTimeout(function() {
                    analyzeText(editor.textContent);
                }, 500);
            });
            
            // Gérer le collage de texte pour s'assurer qu'il reste dans l'éditeur
            editor.addEventListener('paste', function(e) {
                e.preventDefault();
                
                // Récupérer le texte brut du presse-papiers
                const text = (e.clipboardData || window.clipboardData).getData('text/plain');
                
                // Insérer le texte à la position du curseur
                document.execCommand('insertText', false, text);
                
                // Analyser le texte après un court délai
                clearTimeout(editorTimeout);
                editorTimeout = setTimeout(function() {
                    analyzeText(editor.textContent);
                }, 500);
            });
            
            // Écouter les clics sur le bouton de commande de guide
            document.querySelector('#toggle-guide').onclick = function() {
                console.log('Clic sur le bouton toggle-guide');
                const guideContent = document.getElementById('guide-content');
                if (guideContent.classList.contains('hidden')) {
                    guideContent.classList.remove('hidden');
                    this.textContent = '-';
                } else {
                    guideContent.classList.add('hidden');
                    this.textContent = '+';
                }
            };
            
            // Écouter les clics sur le bouton de commande de guide
            document.querySelector('#order-guide-button').onclick = function() {
                console.log('Clic sur le bouton order-guide-button');
                orderGuide();
            };
            
            // Écouter les clics sur le bouton de chargement des données par défaut
            document.querySelector('#load-default-data').onclick = function() {
                console.log('Clic sur le bouton load-default-data');
                loadDefaultData();
            };
            
            // Écouter les clics sur le bouton d'intention de recherche
            document.querySelector('#toggle-intention').onclick = function() {
                console.log('Clic sur le bouton toggle-intention');
                const intentionContent = document.getElementById('intention-content');
                if (intentionContent.classList.contains('hidden')) {
                    intentionContent.classList.remove('hidden');
                    this.textContent = '-';
                } else {
                    intentionContent.classList.add('hidden');
                    this.textContent = '+';
                }
            };
            
            // Écouter les clics sur le bouton de recherche
            document.getElementById('search-button').addEventListener('click', function() {
                const query = document.getElementById('search-query').value.trim();
                if (query) {
                    currentQuery = query;
                    loadInitialData();
                }
            });
        }

        // Analyser le texte et mettre à jour l'interface
        function analyzeText(text) {
            // Analyser le texte localement pour les mots-clés
            const text_lower = text.toLowerCase();
            const words = text_lower.split(/\s+/);
            
            // Réinitialiser les données du graphique
            keywordData = [];
            
            // Compter les occurrences des mots-clés obligatoires
            for (const [keyword, data] of Object.entries(keywords.obligatoires)) {
                let count = 0;
                const keywordLower = keyword.toLowerCase();
                
                for (const word of words) {
                    if (word === keywordLower) {
                        count++;
                    }
                }
                
                keywords.obligatoires[keyword].count = count;
                keywords.obligatoires[keyword].completed = count >= data.minRequired;
                
                // Ajouter les données pour le graphique
                // Utiliser minRequired pour déterminer si le mot-clé est complété
                const importance = data.importance;
                
                // Garder les données complètes pour le calcul du ratio dans le graphique
                
                keywordData.push({
                    keyword: keyword,
                    count: count,
                    required: data.required, // Format "min,max"
                    minRequired: data.minRequired,
                    maxRequired: data.maxRequired,
                    importance: importance,
                    type: 'obligatoire'
                });
            }
            
            // Compter les occurrences des mots-clés complémentaires
            for (const [keyword, data] of Object.entries(keywords.complementaires)) {
                let count = 0;
                const keywordLower = keyword.toLowerCase();
                
                for (const word of words) {
                    if (word === keywordLower) {
                        count++;
                    }
                }
                
                keywords.complementaires[keyword].count = count;
                keywords.complementaires[keyword].completed = count >= data.minRequired;
                
                // Ajouter les données pour le graphique
                const importance = data.importance;
                
                keywordData.push({
                    keyword: keyword,
                    count: count,
                    required: data.required, // Format "min,max"
                    minRequired: data.minRequired,
                    maxRequired: data.maxRequired,
                    importance: importance,
                    type: 'complementaire'
                });
            }
            
            // Vérifier les n-grams
            const ngrams_found = [];
            const allNgrams = document.querySelector('#editor').getAttribute('data-ngrams') || '';
            const ngramArray = allNgrams.split(';').filter(ng => ng.trim());
            
            for (const ngram of ngramArray) {
                if (text_lower.includes(ngram.toLowerCase())) {
                    ngrams_found.push(ngram);
                }
            }
            
            ngrams = ngrams_found;
            
            // Calculer les statistiques
            const wordCount = words.length;
            const motsRequis = parseInt(document.getElementById('mots-requis').textContent) || 0;
            
            // Calculer le score SEO basé sur les mots-clés obligatoires
            const totalKwObligatoires = Object.keys(keywords.obligatoires).length;
            
            // Calcul pondéré du score SEO en fonction du nombre de fois que chaque mot-clé est utilisé
            let scoreTotal = 0;
            let scoreMaxPossible = 0;
            
            for (const [keyword, data] of Object.entries(keywords.obligatoires)) {
                const minRequired = data.minRequired || 0;
                const count = data.count || 0;
                
                // Calculer le score pour ce mot-clé (plafonné au minimum requis)
                const keywordScore = Math.min(count, minRequired);
                scoreTotal += keywordScore;
                scoreMaxPossible += minRequired;
            }
            
            // Calculer le score SEO en pourcentage
            const scoreSeo = scoreMaxPossible > 0 ? Math.round((scoreTotal / scoreMaxPossible) * 100) : 0;
            
            // Calculer le pourcentage des 200 premiers mots
            const premiersMotsCount = Math.min(wordCount, 200);
            
            // Compter les mots-clés dans les 200 premiers mots
            const premiersMotsText = text.split(/\s+/).slice(0, 200).join(' ').toLowerCase();
            let kwDansPremiersMotsCount = 0;
            
            for (const keyword of Object.keys(keywords.obligatoires)) {
                const regex = new RegExp('\\b' + escapeRegExp(keyword.toLowerCase()) + '\\b', 'g');
                const matches = premiersMotsText.match(regex);
                if (matches) {
                    kwDansPremiersMotsCount += matches.length;
                }
            }
            
            // Calculer le pourcentage de mots-clés dans les 200 premiers mots
            // Objectif: au moins 2% des 200 premiers mots devraient être des mots-clés
            const premiersMotsTarget = 4; // 2% de 200 mots = 4 mots-clés
            const premiersMotsPercent = Math.min(100, Math.round((kwDansPremiersMotsCount / premiersMotsTarget) * 100));
            
            // Calculer le score de suroptimisation
            // Vérifier si des mots-clés sont utilisés plus que leur maximum recommandé
            let suroptimisationScore = 0;
            let totalSuroptimises = 0;
            
            for (const [keyword, data] of Object.entries(keywords.obligatoires)) {
                const maxRequired = data.maxRequired || (data.minRequired * 2);
                const count = data.count || 0;
                
                if (count > maxRequired) {
                    totalSuroptimises += 1;
                    suroptimisationScore += (count - maxRequired) / maxRequired;
                }
            }
            
            // Convertir le score de suroptimisation en pourcentage
            const maxSuroptimisation = parseInt(document.getElementById('max-suroptimisation').textContent) || 5;
            const suroptimisationPercent = Math.min(100, Math.round((suroptimisationScore * 100) / maxSuroptimisation));
            
            // Mettre à jour l'interface
            updateKeywordLists();
            updateStatistics({
                score_seo: scoreSeo,
                word_count: wordCount,
                mots_requis: motsRequis,
                premiers_mots: {
                    count: kwDansPremiersMotsCount,
                    target: premiersMotsTarget
                },
                suroptimisation: suroptimisationPercent,
                max_suroptimisation: maxSuroptimisation
            });
            highlightKeywords();
            
            // Mettre à jour le graphique d'optimisation
            updateOptimizationChart();
        }

        // Mettre à jour les données des mots-clés
        function updateKeywordsData(data) {
            console.log('Mise à jour des données de mots-clés:', data);
            
            // Mots-clés obligatoires
            keywords.obligatoires = {};
            if (data.KW_obligatoires && Array.isArray(data.KW_obligatoires)) {
                console.log('Mots-clés obligatoires:', data.KW_obligatoires);
                data.KW_obligatoires.forEach(kw => {
                    const kwData = extractMinMaxValues(kw);
                    if (kwData) {
                        const keyword = kwData.keyword;
                        const minRequired = kwData.min;
                        const maxRequired = kwData.max;
                        const count = 0; // Sera mis à jour lors de l'analyse du texte
                        
                        keywords.obligatoires[keyword] = {
                            count: count,
                            required: `${minRequired},${maxRequired}`, // Format "min,max" pour utilisation ultérieure
                            minRequired: minRequired,
                            maxRequired: maxRequired,
                            importance: maxRequired, // Utiliser maxRequired comme importance pour le tri
                            completed: count >= minRequired
                        };
                    } else {
                        console.warn('Format de mot-clé obligatoire invalide:', kw);
                    }
                });
            } else {
                console.warn('Aucun mot-clé obligatoire trouvé ou format invalide');
            }
            
            // Mots-clés complémentaires
            keywords.complementaires = {};
            if (data.KW_complementaires && Array.isArray(data.KW_complementaires)) {
                data.KW_complementaires.forEach(kw => {
                    const kwData = extractMinMaxValues(kw);
                    if (kwData) {
                        const keyword = kwData.keyword;
                        const minRequired = kwData.min;
                        const maxRequired = kwData.max;
                        const count = 0; // Sera mis à jour lors de l'analyse du texte
                        
                        keywords.complementaires[keyword] = {
                            count: count,
                            required: `${minRequired},${maxRequired}`, // Format "min,max" pour utilisation ultérieure
                            minRequired: minRequired,
                            maxRequired: maxRequired,
                            importance: maxRequired, // Utiliser maxRequired comme importance pour le tri
                            completed: count >= minRequired
                        };
                    } else {
                        console.warn('Format de mot-clé complémentaire invalide:', kw);
                    }
                });
            }
            
            // N-grams
            if (data.ngrams) {
                const ngramList = typeof data.ngrams === 'string' ? data.ngrams.split(';') : data.ngrams;
                document.getElementById('editor').setAttribute('data-ngrams', ngramList.join(';'));
            }
            
            // Mettre à jour les statistiques globales
            if (data.mots_requis) {
                document.getElementById('mots-requis').textContent = data.mots_requis;
            }
            
            if (data.score_target) {
                document.getElementById('kw-obligatoires-count').textContent = data.score_target;
            }
            
            if (data.max_suroptimisation) {
                document.getElementById('max-suroptimisation').textContent = data.max_suroptimisation;
            }
        }

        // Mettre à jour les listes de mots-clés dans l'interface
        function updateKeywordLists() {
            // Mettre à jour la liste des mots-clés obligatoires
            const kwObligatoiresList = document.getElementById('kw-obligatoires-list');
            kwObligatoiresList.innerHTML = '';
            
            let completedObligatoires = 0;
            let totalObligatoires = Object.keys(keywords.obligatoires).length;
            
            for (const [keyword, data] of Object.entries(keywords.obligatoires)) {
                if (data.completed) {
                    completedObligatoires++;
                }
                
                const keywordItem = document.createElement('div');
                keywordItem.className = 'keyword-item';
                keywordItem.innerHTML = `
                    <span class="keyword-count ${data.completed ? 'completed' : ''}">${data.count}</span>
                    <span class="keyword-text ${data.completed ? 'completed' : ''}">${keyword}</span>
                    <span class="keyword-required" title="Min: ${data.minRequired}, Max: ${data.maxRequired}">${data.minRequired}-${data.maxRequired}</span>
                `;
                kwObligatoiresList.appendChild(keywordItem);
            }
            
            // Mettre à jour le résumé des mots-clés obligatoires
            document.getElementById('kw-obligatoires-summary').textContent = `${completedObligatoires}/${totalObligatoires}`;
            
            // Mettre à jour la liste des mots-clés complémentaires
            const kwComplementairesList = document.getElementById('kw-complementaires-list');
            kwComplementairesList.innerHTML = '';
            
            let completedComplementaires = 0;
            let totalComplementaires = Object.keys(keywords.complementaires).length;
            
            for (const [keyword, data] of Object.entries(keywords.complementaires)) {
                if (data.completed) {
                    completedComplementaires++;
                }
                
                const keywordItem = document.createElement('div');
                keywordItem.className = 'keyword-item';
                keywordItem.innerHTML = `
                    <span class="keyword-count ${data.completed ? 'completed' : ''}">${data.count}</span>
                    <span class="keyword-text ${data.completed ? 'completed' : ''}">${keyword}</span>
                    <span class="keyword-required" title="Min: ${data.minRequired}, Max: ${data.maxRequired}">${data.minRequired}-${data.maxRequired}</span>
                `;
                kwComplementairesList.appendChild(keywordItem);
            }
            
            // Mettre à jour le résumé des mots-clés complémentaires
            document.getElementById('kw-complementaires-summary').textContent = `${completedComplementaires}/${totalComplementaires}`;
            
            // Mettre à jour la liste des n-grams
            const ngramsList = document.getElementById('ngrams-list');
            ngramsList.innerHTML = '';
            
            // Récupérer tous les n-grams depuis l'API
            const allNgrams = document.querySelector('#editor').getAttribute('data-ngrams') || '';
            const ngramArray = allNgrams.split(';').filter(ng => ng.trim());
            
            for (const ngram of ngramArray) {
                const ngramItem = document.createElement('span');
                ngramItem.className = `ngram-item ${ngrams.includes(ngram) ? 'found' : ''}`;
                ngramItem.textContent = ngram;
                ngramsList.appendChild(ngramItem);
            }
        }

        // Mettre à jour les statistiques
        function updateStatistics(data) {
            // Score SEO
            const scoreSeoElement = document.getElementById('score-seo');
            scoreSeoElement.textContent = `${data.score_seo}%`;
            
            // Mise à jour de la couleur du score SEO en fonction de sa valeur
            if (data.score_seo >= 80) {
                scoreSeoElement.className = 'text-2xl font-bold text-green-600'; // Excellent
            } else if (data.score_seo >= 60) {
                scoreSeoElement.className = 'text-2xl font-bold text-blue-600'; // Bon
            } else if (data.score_seo >= 40) {
                scoreSeoElement.className = 'text-2xl font-bold text-yellow-600'; // Moyen
            } else {
                scoreSeoElement.className = 'text-2xl font-bold text-red-600'; // À améliorer
            }
            
            // 200 premiers mots
            const premiersMotsElement = document.getElementById('premiers-mots-percent');
            premiersMotsElement.textContent = `${data.premiers_mots.count}/${data.premiers_mots.target}`;
            
            // Mise à jour de la couleur du score des 200 premiers mots
            const premiersMotsPercent = Math.min(100, Math.round((data.premiers_mots.count / data.premiers_mots.target) * 100));
            if (premiersMotsPercent >= 100) {
                premiersMotsElement.className = 'text-2xl font-bold text-green-600'; // Excellent
            } else if (premiersMotsPercent >= 75) {
                premiersMotsElement.className = 'text-2xl font-bold text-blue-600'; // Bon
            } else if (premiersMotsPercent >= 50) {
                premiersMotsElement.className = 'text-2xl font-bold text-yellow-600'; // Moyen
            } else {
                premiersMotsElement.className = 'text-2xl font-bold text-red-600'; // À améliorer
            }
            
            // Suroptimisation
            const suroptimisationElement = document.getElementById('suroptimisation');
            suroptimisationElement.textContent = `${data.suroptimisation}%`;
            document.getElementById('max-suroptimisation').textContent = data.max_suroptimisation;
            
            // Mise à jour de la couleur du score de suroptimisation (plus c'est bas, mieux c'est)
            if (data.suroptimisation <= 20) {
                suroptimisationElement.className = 'text-2xl font-bold text-green-600'; // Excellent
            } else if (data.suroptimisation <= 50) {
                suroptimisationElement.className = 'text-2xl font-bold text-blue-600'; // Bon
            } else if (data.suroptimisation <= 80) {
                suroptimisationElement.className = 'text-2xl font-bold text-yellow-600'; // Attention
            } else {
                suroptimisationElement.className = 'text-2xl font-bold text-red-600'; // Problème
            }
            
            // Nombre de mots
            const wordCountElement = document.getElementById('word-count');
            wordCountElement.textContent = data.word_count;
            document.getElementById('mots-requis').textContent = data.mots_requis;
            document.getElementById('mots-restants').textContent = Math.max(0, data.mots_requis - data.word_count);
            
            // Mise à jour de la couleur du nombre de mots
            const wordCountPercent = Math.min(100, Math.round((data.word_count / data.mots_requis) * 100));
            if (wordCountPercent >= 100) {
                wordCountElement.className = 'text-2xl font-bold text-green-600'; // Excellent
            } else if (wordCountPercent >= 75) {
                wordCountElement.className = 'text-2xl font-bold text-blue-600'; // Bon
            } else if (wordCountPercent >= 50) {
                wordCountElement.className = 'text-2xl font-bold text-yellow-600'; // Moyen
            } else {
                wordCountElement.className = 'text-2xl font-bold text-red-600'; // À améliorer
            }
            
            // Stocker les n-grams dans un attribut data pour référence future
            document.getElementById('editor').setAttribute('data-ngrams', data.ngrams || '');
        }

        // Surligner les mots-clés dans l'éditeur
        function highlightKeywords() {
            // Effacer les surlignages précédents
            marker.unmark();
            
            // Surligner les mots-clés obligatoires
            for (const keyword of Object.keys(keywords.obligatoires)) {
                marker.mark(keyword, {
                    className: 'obligatoire',
                    accuracy: 'exactly',
                    separateWordSearch: false
                });
            }
            
            // Surligner les mots-clés complémentaires
            for (const keyword of Object.keys(keywords.complementaires)) {
                marker.mark(keyword, {
                    className: 'complementaire',
                    accuracy: 'exactly',
                    separateWordSearch: false
                });
            }
            
            // Surligner les n-grams trouvés
            for (const ngram of ngrams) {
                marker.mark(ngram, {
                    className: 'ngram',
                    accuracy: 'exactly',
                    separateWordSearch: false
                });
            }
        }

        // Initialiser les fonctionnalités d'édition de texte
        function initTextEditor() {
            // Boutons de formatage
            document.getElementById('bold-button').addEventListener('click', () => execFormatCommand('bold'));
            document.getElementById('italic-button').addEventListener('click', () => execFormatCommand('italic'));
            document.getElementById('underline-button').addEventListener('click', () => execFormatCommand('underline'));
            document.getElementById('strikethrough-button').addEventListener('click', () => execFormatCommand('strikeThrough'));
            document.getElementById('bullet-list-button').addEventListener('click', () => execFormatCommand('insertUnorderedList'));
            document.getElementById('numbered-list-button').addEventListener('click', () => execFormatCommand('insertOrderedList'));
            document.getElementById('blockquote-button').addEventListener('click', () => formatBlockquote());
            document.getElementById('link-button').addEventListener('click', () => createLink());
            document.getElementById('image-button').addEventListener('click', () => insertImage());
            document.getElementById('table-button').addEventListener('click', () => insertTable());
            document.getElementById('code-button').addEventListener('click', () => insertCode());
            document.getElementById('undo-button').addEventListener('click', () => execFormatCommand('undo'));
            document.getElementById('redo-button').addEventListener('click', () => execFormatCommand('redo'));
            
            // Menus déroulants
            document.getElementById('heading-button').addEventListener('click', toggleDropdown('heading-dropdown'));
            document.getElementById('align-button').addEventListener('click', toggleDropdown('align-dropdown'));
            
            // Boutons de titres
            const headingButtons = document.querySelectorAll('#heading-dropdown button');
            headingButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const format = this.getAttribute('data-format');
                    formatHeading(format);
                    document.getElementById('heading-dropdown').classList.remove('show');
                });
            });
            
            // Boutons d'alignement
            const alignButtons = document.querySelectorAll('#align-dropdown button');
            alignButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const align = this.getAttribute('data-align');
                    execFormatCommand('justify' + align.charAt(0).toUpperCase() + align.slice(1));
                    document.getElementById('align-dropdown').classList.remove('show');
                });
            });
            
            // Couleur du texte
            document.getElementById('text-color-button').addEventListener('click', () => changeTextColor());
            
            // Fermer les menus déroulants quand on clique ailleurs
            document.addEventListener('click', function(event) {
                const dropdowns = document.querySelectorAll('.dropdown-content');
                dropdowns.forEach(dropdown => {
                    if (!event.target.closest('.dropdown') && dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                });
            });
        }
        
        // Exécuter une commande de formatage
        function execFormatCommand(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('editor').focus();
        }
        
        // Formatter un titre
        function formatHeading(format) {
            if (format === 'p') {
                execFormatCommand('formatBlock', '<p>');
            } else {
                execFormatCommand('formatBlock', '<' + format + '>');
            }
        }
        
        // Formatter une citation
        function formatBlockquote() {
            execFormatCommand('formatBlock', '<blockquote>');
        }
        
        // Créer un lien
        function createLink() {
            const url = prompt('Entrez l\'URL du lien:', 'http://');
            if (url) {
                execFormatCommand('createLink', url);
            }
        }
        
        // Insérer une image
        function insertImage() {
            const url = prompt('Entrez l\'URL de l\'image:', 'http://');
            if (url) {
                execFormatCommand('insertImage', url);
            }
        }
        
        // Insérer un tableau
        function insertTable() {
            const rows = prompt('Nombre de lignes:', '3');
            const cols = prompt('Nombre de colonnes:', '3');
            
            if (rows && cols) {
                let table = '<table><tbody>';
                for (let i = 0; i < parseInt(rows); i++) {
                    table += '<tr>';
                    for (let j = 0; j < parseInt(cols); j++) {
                        if (i === 0) {
                            table += '<th>Titre ' + (j + 1) + '</th>';
                        } else {
                            table += '<td>Cellule ' + (i + 1) + '-' + (j + 1) + '</td>';
                        }
                    }
                    table += '</tr>';
                }
                table += '</tbody></table>';
                
                execFormatCommand('insertHTML', table);
            }
        }
        
        // Insérer du code
        function insertCode() {
            const selection = window.getSelection().toString();
            const code = '<code>' + (selection || 'code') + '</code>';
            execFormatCommand('insertHTML', code);
        }
        
        // Changer la couleur du texte
        function changeTextColor() {
            const color = prompt('Entrez une couleur (nom ou code hexadécimal):', '#3b82f6');
            if (color) {
                execFormatCommand('foreColor', color);
            }
        }
        
        // Fonction pour basculer l'affichage d'un menu déroulant
        function toggleDropdown(id) {
            return function() {
                document.getElementById(id).classList.toggle('show');
            };
        }
        
        // Commander un guide à partir d'un mot-clé
        // Charger des données par défaut sans appeler l'API
        function loadDefaultData() {
            console.log('Chargement des données par défaut');
            
            // Afficher le statut
            const guideStatus = document.getElementById('guide-status');
            guideStatus.classList.remove('hidden');
            guideStatus.innerHTML = '<div class="text-blue-500">Chargement des données par défaut...</div>';
            
            try {
                // Utiliser les données par défaut prédéfinies
                console.log('Utilisation des données par défaut prédéfinies');
                
                // Mettre à jour le statut
                guideStatus.innerHTML = '<div class="text-green-500">Données par défaut chargées avec succès !</div>';
                
                // Mettre à jour la requête actuelle
                currentQuery = defaultData.query;
                
                // Mettre à jour directement les données
                updateKeywordsData(defaultData);
                updateKeywordLists();
                updateStatistics(defaultData);
                updateOptimizationChart();
                
                // Analyser le texte actuel avec les nouveaux mots-clés
                const editor = document.getElementById('editor');
                if (editor) {
                    analyzeText(editor.textContent);
                }
                
                // Fermer la section de commande après un court délai
                setTimeout(() => {
                    document.getElementById('guide-content').classList.add('hidden');
                    document.getElementById('toggle-guide').textContent = '+';
                }, 3000);
            } catch (error) {
                console.error('Erreur lors du chargement des données par défaut:', error);
                guideStatus.innerHTML = `<div class="text-red-500">Erreur: ${error.message}</div>`;
            }
        }
        
        function orderGuide() {
            const keywords = document.getElementById('guide-keywords').value.trim();
            if (!keywords) {
                alert('Veuillez entrer un mot-clé');
                return;
            }
            
            // Afficher le statut
            const guideStatus = document.getElementById('guide-status');
            guideStatus.classList.remove('hidden');
            guideStatus.innerHTML = '<div class="text-blue-500">Commande en cours...</div>';
            
            // Envoyer la requête à l'API
            fetch(`${API_URL}/order-guide`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    keywords: keywords
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Guide commandé avec succès:', data);
                
                // Mettre à jour le statut
                guideStatus.innerHTML = '<div class="text-green-500">Guide commandé avec succès !</div>';
                
                // Mettre à jour la requête actuelle
                currentQuery = keywords;
                
                // Mettre à jour directement les données sans passer par loadInitialData
                updateKeywordsData(data);
                updateKeywordLists();
                updateStatistics(data);
                updateOptimizationChart();
                
                // Analyser le texte actuel avec les nouveaux mots-clés
                const editor = document.getElementById('editor');
                if (editor) {
                    analyzeText(editor.textContent);
                }
                
                // Fermer la section de commande
                setTimeout(() => {
                    document.getElementById('guide-content').classList.add('hidden');
                    document.getElementById('toggle-guide').textContent = '+';
                }, 3000);
            })
            .catch(error => {
                console.error('Erreur lors de la commande du guide:', error);
                guideStatus.innerHTML = `<div class="text-red-500">Erreur: ${error.message}</div>`;
            });
        }
        
        // Variables globales pour le graphique
        let displayData = [];
        let highlightedPoint = null;
        
        // Initialiser le graphique d'optimisation avec ApexCharts
        function initOptimizationChart() {
            const options = {
                series: [{
                    name: 'Votre contenu',
                    data: []
                }],
                chart: {
                    height: 280,
                    type: 'line',
                    toolbar: {
                        show: false
                    },
                    animations: {
                        enabled: true,
                        easing: 'easeinout',
                        speed: 800
                    },
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    background: 'transparent',
                    parentHeightOffset: 0,
                    sparkline: {
                        enabled: false
                    }
                },
                plotOptions: {
                    line: {
                        offsetX: 0
                    }
                },
                stroke: {
                    width: 2,
                    curve: 'straight'
                },
                colors: ['#000000'],
                markers: {
                    size: 4,
                    colors: ['#000000'],
                    strokeWidth: 0,
                    hover: {
                        size: 6
                    }
                },
                grid: {
                    show: true,
                    borderColor: '#f1f1f1',
                    strokeDashArray: 3,
                    position: 'back',
                    padding: {
                        left: 10,
                        right: 10,
                        top: 10,
                        bottom: 10
                    }
                },
                annotations: {
                    position: 'front',
                    yaxis: [
                        {
                            y: 0,
                            y2: 1.0,
                            borderColor: '#90cdf4',
                            fillColor: 'rgba(147, 197, 253, 0.5)',
                            label: {
                                text: '',
                                position: 'left',
                                offsetX: 0,
                                offsetY: 0,
                                style: {
                                    background: 'transparent',
                                    color: 'transparent',
                                    fontSize: '0px',
                                    fontWeight: 0,
                                    padding: {
                                        left: 0,
                                        right: 0,
                                        top: 0,
                                        bottom: 0
                                    }
                                }
                            }
                        },
                        {
                            y: 1.0,
                            y2: 1.5,
                            borderColor: '#9ae6b4',
                            fillColor: 'rgba(74, 222, 128, 0.5)',
                            label: {
                                text: '',
                                position: 'left',
                                offsetX: 0,
                                offsetY: 0,
                                style: {
                                    background: 'transparent',
                                    color: 'transparent',
                                    fontSize: '0px',
                                    fontWeight: 0,
                                    padding: {
                                        left: 0,
                                        right: 0,
                                        top: 0,
                                        bottom: 0
                                    }
                                }
                            }
                        },
                        {
                            y: 1.5,
                            y2: 2.0,
                            borderColor: '#fbd38d',
                            fillColor: 'rgba(251, 191, 36, 0.5)',
                            label: {
                                text: '',
                                position: 'left',
                                offsetX: 0,
                                offsetY: 0,
                                style: {
                                    background: 'transparent',
                                    color: 'transparent',
                                    fontSize: '0px',
                                    fontWeight: 0,
                                    padding: {
                                        left: 0,
                                        right: 0,
                                        top: 0,
                                        bottom: 0
                                    }
                                }
                            }
                        },
                        {
                            y: 2.0,
                            y2: 2.5,
                            borderColor: '#feb2b2',
                            fillColor: 'rgba(239, 68, 68, 0.5)',
                            label: {
                                text: '',
                                position: 'left',
                                offsetX: 0,
                                offsetY: 0,
                                style: {
                                    background: 'transparent',
                                    color: 'transparent',
                                    fontSize: '0px',
                                    fontWeight: 0,
                                    padding: {
                                        left: 0,
                                        right: 0,
                                        top: 0,
                                        bottom: 0
                                    }
                                }
                            }
                        }
                    ]
                },
                xaxis: {
                    categories: [],
                    labels: {
                        rotate: -45,
                        style: {
                            fontSize: '10px',
                            fontWeight: 400
                        },
                        formatter: function(value) {
                            // Raccourcir les mots-clés trop longs
                            if (value.length > 10) {
                                return value.substring(0, 10) + '...';
                            }
                            return value;
                        },
                        offsetX: 2,
                        offsetY: 0
                    },
                    tickPlacement: 'on',
                    axisBorder: {
                        show: false
                    },
                    axisTicks: {
                        show: false
                    },
                    padding: {
                        left: 10,
                        right: 10
                    }
                },
                yaxis: {
                    min: 0,
                    max: 2.5,
                    labels: {
                        show: false
                    }
                },
                tooltip: {
                    enabled: true,
                    shared: false,
                    intersect: true,
                    custom: function({ series, seriesIndex, dataPointIndex, w }) {
                        const keyword = w.globals.labels[dataPointIndex];
                        const value = series[seriesIndex][dataPointIndex];
                        const ratio = Math.round(value * 100);
                        
                        // Trouver les données complètes du mot-clé
                        const fullData = displayData.find(item => item.keyword === keyword || 
                                                           (item.keyword.length > 10 && keyword === item.keyword.substring(0, 10) + '...'));
                        
                        if (fullData) {
                            // Utiliser directement les propriétés minRequired et maxRequired
                            let minCount = fullData.minRequired || 0;
                            let maxCount = fullData.maxRequired || 0;
                            let rangeText = '';
                            let zoneText = '';
                            
                            // Construire le texte d'affichage pour la plage
                            if (minCount > 0 && maxCount > 0) {
                                rangeText = `${minCount}-${maxCount}`;
                            } else if (minCount > 0) {
                                rangeText = `${minCount}`;
                            }
                            
                            // Déterminer la zone d'optimisation
                            if (value >= 2.0) {
                                zoneText = 'Suroptimisation';
                            } else if (value >= 1.5) {
                                zoneText = 'Optimisation forte';
                            } else if (value >= 1.0) {
                                zoneText = 'Optimisation normale';
                            } else {
                                zoneText = 'Sous-optimisation';
                            }
                            
                            return `<div class="p-2 bg-gray-800 text-white rounded shadow-lg">
                                <div class="font-bold">${fullData.keyword}</div>
                                <div>Occurrences: ${fullData.count}</div>
                                <div>Plage optimale: ${rangeText}</div>
                                <div>Zone: ${zoneText}</div>
                            </div>`;
                        }
                        
                        return `<div class="p-2 bg-gray-800 text-white rounded shadow-lg">
                            <div class="font-bold">${keyword}</div>
                            <div>Ratio: ${ratio}%</div>
                        </div>`;
                    }
                },
                legend: {
                    show: false
                },
                dataLabels: {
                    enabled: false
                }
            };
            
            optimizationChart = new ApexCharts(document.querySelector("#optimization-chart"), options);
            optimizationChart.render();
        }
        
        // Mettre à jour le graphique d'optimisation avec ApexCharts
        function updateOptimizationChart() {
            if (!optimizationChart) {
                console.warn('Le graphique d\'optimisation n\'est pas initialisé');
                return;
            }
            
            console.log('Mise à jour du graphique avec les données:', keywordData);
            
            // Vérifier si nous avons des données
            if (keywordData.length === 0) {
                console.warn('Aucune donnée de mot-clé disponible pour le graphique');
                return;
            }
            
            // Trier les mots-clés par importance décroissante
            const sortedData = [...keywordData].sort((a, b) => b.importance - a.importance);
            
            // Limiter à un nombre raisonnable de mots-clés pour le graphique
            const maxKeywords = 40; // Augmenter pour montrer plus de mots-clés comme dans l'exemple
            displayData = sortedData.slice(0, maxKeywords);
            
            // Préparer les données pour le graphique
            // Utiliser les vrais mots-clés comme labels
            const labels = displayData.map((item) => item.keyword);
            
            // Calculer correctement les ratios pour chaque mot-clé
            const contentValues = displayData.map(item => {
                // Utiliser directement les valeurs minRequired et maxRequired
                let minCount = item.minRequired || 0;
                let maxCount = item.maxRequired || 0;
                let ratio = 0;
                
                // Calculer le ratio en fonction de la position dans la plage
                if (maxCount > minCount) {
                    if (item.count < minCount) {
                        // Sous-optimisation (0 - 1.0)
                        ratio = item.count / minCount;
                    } else if (item.count > maxCount) {
                        // Suroptimisation (2.0+)
                        ratio = 2.0 + ((item.count - maxCount) / maxCount) * 0.5;
                    } else {
                        // Entre min et max (1.0 - 2.0)
                        // Mapper la plage [minCount, maxCount] à [1.0, 2.0]
                        ratio = 1.0 + ((item.count - minCount) / (maxCount - minCount));
                    }
                } else if (minCount > 0) {
                    // Si min = max, utiliser simplement le ratio count/min
                    ratio = item.count / minCount;
                }
                
                // Limiter le ratio entre 0 et 2.5 (max du graphique)
                return Math.min(ratio, 2.5);
            });
            
            console.log('Données préparées pour le graphique:', {
                labels: labels,
                values: contentValues,
                rawData: displayData
            });
            
            // Mettre à jour les données du graphique
            optimizationChart.updateOptions({
                xaxis: {
                    categories: labels
                }
            });
            
            optimizationChart.updateSeries([{
                name: 'Votre contenu',
                data: contentValues
            }]);
            
            // Mettre à jour la liste des mots-clés sous le graphique
            updateGraphKeywordsList(displayData);
        }
        
        // Mettre à jour la liste des mots-clés sous le graphique
        function updateGraphKeywordsList(keywordsData) {
            const keywordsList = document.getElementById('graph-keywords-list');
            if (!keywordsList) return;
            
            // Vider la liste actuelle
            keywordsList.innerHTML = '';
            
            // Ajouter chaque mot-clé sous forme de puce colorée
            keywordsData.forEach((item, index) => {
                // Extraire les valeurs min et max de la plage d'optimisation
                let minCount = 0;
                let maxCount = 0;
                let ratio = 0;
                let rangeText = '';
                
                if (item.required && typeof item.required === 'string' && item.required.includes(',')) {
                    // Format "min,max" (ex: "2,44")
                    const parts = item.required.split(',');
                    minCount = parseInt(parts[0], 10) || 0;
                    maxCount = parseInt(parts[1], 10) || minCount * 2;
                    rangeText = `${item.count}/${minCount}-${maxCount}`;
                } else if (item.required > 0) {
                    // Format numérique simple
                    minCount = item.required;
                    maxCount = item.required * 2; // Par défaut, max = 2x min
                    rangeText = `${item.count}/${item.required}`;
                } else {
                    rangeText = `${item.count}/0`;
                }
                
                // Calculer le ratio en fonction de la position dans la plage
                if (maxCount > minCount) {
                    if (item.count < minCount) {
                        // Sous-optimisation (0 - 1.0)
                        ratio = item.count / minCount;
                    } else if (item.count > maxCount) {
                        // Suroptimisation (2.0+)
                        ratio = 2.0 + ((item.count - maxCount) / maxCount) * 0.5;
                    } else {
                        // Entre min et max (1.0 - 2.0)
                        // Mapper la plage [minCount, maxCount] à [1.0, 2.0]
                        ratio = 1.0 + ((item.count - minCount) / (maxCount - minCount));
                    }
                } else if (minCount > 0) {
                    // Si min = max, utiliser simplement le ratio count/min
                    ratio = item.count / minCount;
                }
                
                let bgColor = '';
                if (ratio >= 2.0) {
                    bgColor = 'bg-red-500 text-white'; // Suroptimisation
                } else if (ratio >= 1.5) {
                    bgColor = 'bg-yellow-500 text-black'; // Optimisation forte
                } else if (ratio >= 1.0) {
                    bgColor = 'bg-green-400 text-black'; // Optimisation normale
                } else {
                    bgColor = 'bg-blue-300 text-black'; // Sous-optimisation
                }
                
                // Créer la puce
                const chip = document.createElement('div');
                chip.className = `${bgColor} rounded-full px-2 py-0.5 cursor-pointer transition-all hover:shadow-md inline-flex items-center`;
                chip.innerHTML = `<span class="font-semibold">${index + 1}. ${item.keyword}</span> <span class="ml-1">${rangeText}</span>`;
                
                // Ajouter l'événement de survol pour mettre en évidence le point correspondant
                chip.addEventListener('mouseenter', () => {
                    highlightGraphPoint(index);
                });
                
                chip.addEventListener('mouseleave', () => {
                    resetGraphHighlights();
                });
                
                keywordsList.appendChild(chip);
            });
        }
        
        // Mettre en évidence un point spécifique sur le graphique
        function highlightGraphPoint(index) {
            if (!optimizationChart) return;
            
            // Stocker l'index du point mis en évidence
            highlightedPoint = index;
            
            // Créer un tableau de marqueurs avec une taille plus grande pour le point sélectionné
            const newMarkers = {
                size: Array(displayData.length).fill(4),
                colors: Array(displayData.length).fill('#000000'),
                strokeWidth: Array(displayData.length).fill(0),
                strokeColors: Array(displayData.length).fill('#000000')
            };
            
            // Augmenter la taille du point sélectionné
            newMarkers.size[index] = 8;
            newMarkers.colors[index] = '#3182ce'; // Bleu plus visible
            newMarkers.strokeWidth[index] = 2;
            
            // Appliquer les modifications
            optimizationChart.updateOptions({
                markers: newMarkers
            });
        }
        
        // Réinitialiser les mises en évidence du graphique
        function resetGraphHighlights() {
            if (!optimizationChart) return;
            
            // Réinitialiser l'index du point mis en évidence
            highlightedPoint = null;
            
            // Rétablir les valeurs par défaut pour tous les marqueurs
            optimizationChart.updateOptions({
                markers: {
                    size: 4,
                    colors: ['#000000'],
                    strokeWidth: 0,
                    hover: {
                        size: 6
                    }
                }
            });
        }
        
        // Fonction utilitaire pour échapper les caractères spéciaux dans les expressions régulières
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
    </script>
</body>
</html>
